[文件](https://paper.dropbox.com/doc/Local--B0hjMBBBDMGyiNg4whzC4VkFAg-ggNEv2b1mB2c9dcb6YjHF)

# VS Code Dev Container

使用本機的 VS Code 打開 pinkoi repo 會因為有許多 Python 套件與 VS Code 外掛沒有安裝在本機，而導致程式碼中充滿各種錯誤提示，此時可以使用打包好的 Docker Container 建立一個專門用來開發 pinkoi repo 的 VS Code 環境，步驟如下：

### Step1: 產生 `marketplace-local-vscode` repo

```bash
# 先 cd 至 pinkoi repo，然後：
make vscode-local-env
```

此時會在與 pinkoi repo 同層的位置出現一個名為 `marketplace-local-vscode` 的新 repo。

### Step2: Configure Container

- Step2-1: 使用 VS code 開啟 `marketplace-local-vscode` repo

- Step2-2: 為避免 API Server Container (`web-debug`) 使用的 port 與 VS Code Dev Container 使用的 port 相撞（都是 443），須更改 VS Code Dev Container 的 port，首先要在 `marketplace-local-vscode/.devcontainer` 下找到 `devcontainer.json` 這個檔案，然後找到下面這段：

    ```json
    "runArgs": [
        "-e",
        "HOST_OS=Darwin",
        "-p",
        "127.0.0.1:443:8080"
    ],
    ```

    把它改成：

    ```json
    "runArgs": [
        "-e",
        "HOST_OS=Darwin",
        "-p",
        "127.0.0.1:442:8080"
    ]
    ```

### Step3: Build Container

- Step3-1: `cmd` + `shift` + `P` 開啟 VS code 指令介面

- Step3-2: 輸入 `Rebuild and Reopen in Container` 或是 `Reopen in Container`，如果看到目前的 VS Code 視窗重新啟動並改為開啟 pinkoi repo，那就代表成功了。

# 連線至開發環境

[參考資料](https://xenby.com/b/220-%E6%95%99%E5%AD%B8-%E7%94%A2%E7%94%9Fssh-key%E4%B8%A6%E4%B8%94%E9%80%8F%E9%81%8Ekey%E9%80%B2%E8%A1%8C%E5%85%8D%E5%AF%86%E7%A2%BC%E7%99%BB%E5%85%A5)

**Step1: 先在 local 產生 ssh key，不要設定 paraphrase**

```bash
ssh-keygen
```

**Step2: 用另一台已經可以連線至開發機的電腦將剛產生的公鑰設定至開發機**

- @ 新電腦

    ```bash
    # 顯示公鑰
    cat ~/.ssh/id_rsa.pub
    
    # command + C 複製
    
    # 想辦法傳給一台已經可以連線至開發機的電腦
    ```

- @ 舊電腦

    ```bash
    # 連線至開發機
    ssh office.pinkoi.com
    
    # 新增公鑰在 ~/.ssh/authorized_keys 檔案內
    echo "your-public-key" >> ~/.ssh/authorized_keys
    ```
